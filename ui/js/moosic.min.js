document.addEventListener("DOMContentLoaded",function(){webSocket.init("localhost",function(){uiTools.init(),router.init()})});var dataTools=function(){var e={};return{changeState:function(t){var s=Object.keys(t).filter(s=>void 0===this._state||!(s in e)||t[s]!==e[s]);return 0===s.length?[]:(e=t,s)},formatTime:function(e){var t=e;return(t-(t%=60))/60+(t>9?":":":0")+t},getStatus:function(){return"status"in e?e.status:""},getState:function(){return e},getQuality:function(t,s){return void 0!==e.samplerate&&""!==e.samplerate?void 0!==e.bitdepth&&""!==e.bitdepth?e.samplerate.replace(" ","")+" "+e.bitdepth.replace(" ",""):e.samplerate.replace(" ",""):void 0!==e.bitdepth&&""!==e.bitdepth?e.bitdepth.replace(" ",""):""},getQueuePosition:function(){return parseInt(e.position)}}}(),domBuilder=function(){var e=window.crel.proxy,t="";window.crel.attrMap.on=((e,t)=>{for(const s in t)e.addEventListener(s,t[s])});var s=function(t,{msg:s}={}){var i=document.querySelector(".pageloader");!0===t&&null==i?(i=e.div({class:"pageloader"},e.p({class:"title"},s)),document.body.appendChild(i),window.setTimeout(()=>{i.classList.add("is-active")},200)):!1===t&&null!==i&&(i.classList.remove("is-active"),window.setTimeout(()=>{i.remove()},310))},i=function({image:t,title:s,href:i,uri:a,subtitle:l,subtitleHref:o,subtitleUri:n}={}){return a=a||"",e.div({class:"column is-tile is-2-desktop is-4-tablet is-6-mobile"},e.a({href:i,"data-navigo":"","data-uri":a},e.figure({class:"image is-1by1"},e.img({src:t})),e.p({class:"title is-5 is-capitalized"},s)),void 0!==l?e.a({href:o,"data-navigo":"","data-uri":n},e.p({class:"subtitle is-5"},l)):null)},a=function(t){return e.tr({"data-uri":t.uri,"data-title":t.title,"data-service":t.service},"tracknumber"in t?e.td({class:"pointer",on:{click:uiTools.handlers.tracks}},t.tracknumber):null,e.td({class:"pointer",on:{click:uiTools.handlers.tracks}},t.title),"trackType"in t?null:e.td(t.artist),"trackType"in t?null:e.td(t.album),t.trackType?e.td(t.trackType.toUpperCase()):null,t.duration?e.td(uiTools.formatTime(t.duration)):null,e.td(e.div({class:"dropdown is-right"},e.div({class:"dropdown-trigger"},e.button({"aria-haspopup":!0,on:{click:uiTools.handlers.dropdown}},e.img({src:"/img/icons/ellipsis.svg"}))),e.div({class:"dropdown-menu",role:"menu"},e.div({class:"dropdown-content"},e.span({class:"dropdown-item",on:{click:uiTools.handlers.playSong}},"Play"),e.span({class:"dropdown-item",on:{click:uiTools.handlers.queueSong}},"Add to queue"),e.span({class:"dropdown-item",on:{click:uiTools.handlers.replaceWithSong}},"Clear and play"),e.span({class:"dropdown-item",on:{click:e=>{o.addToPlaylist(e)}}},"Add to playlist"))))))},l={setLoad:function(e){t=e},build:function(s){if(""!==t){var l=t,o=uiTools.clearNodes("#content-container");switch(t){case"home":var n=dataTools.getState(),c=e.div({class:"container is-fluid"}),d="";n.sampleRate&&n.bits&&(d=n.sampleRate/1e3+"kHz "+n.bits+"bit"),c.appendChild(e.div({class:"columns home"},e.div({class:"column is-narrow"},e.figure({class:"image albumart"},e.img())),e.div({class:"column"},e.p({class:"title is-3"},n.title),e.p({class:"artist subtitle is-5"},"By ",e.a({href:"artist/"+n.artist,"data-navigo":""},n.artist)),e.p({class:"album subtitle is-5"},"From the album ",e.a({href:"album/"+n.artist+"/"+n.album,"data-navigo":""},n.album)),e.p({class:"detail subtitle is-5 is-hidden-mobile"},d)))),c.querySelector(".albumart img").src="albumart"in n?n.albumart:"/img/notplaying.png",webSocket.get.queue(),c.appendChild(e.table({id:"queue-table",class:"table is-fullwidth"})),o.appendChild(c);break;case"album":console.log(s),l=s.title+" - "+s.artist;const b=uiTools.formatTime(Math.round(s.songs.reduce((e,t)=>e+parseFloat(t.duration),0)));console.log(b),(c=e.div({class:"container is-fluid"})).appendChild(e.div({class:"columns is-multiline is-mobile album-detail"},e.div({class:"column is-3-desktop is-12-mobile"},e.figure({class:"image is-1by1 albumart"},e.img({src:s.albumart}))),e.div({class:"column is-8-desktop is-12-mobile"},e.p({class:"is-uppercase has-text-weight-semibold is-hidden-mobile"},"Album"),e.p({class:"title is-3 album-title has-text-weight-semibold"},s.title),e.p("By ",e.a({class:"artist has-text-weight-semibold","data-navigo":"",href:"artist/"+encodeURIComponent(s.artist)},s.artist)),e.p({class:"detail"},s.songs.length+" Song"+(s.songs.length>1?"s":"")+" - "+b+(s.songs[0].date?" - "+s.songs[0].date:"")),e.span({class:"tags"}),e.button({class:"button is-rounded is-primary"},"Play album")))),c.appendChild(e.table({class:"table is-fullwidth songs songs-hover"},e.tbody(s.songs.map(function(e){return a(e)})))),o.appendChild(c);break;case"albums":var r=s;(c=e.div({class:"container is-fluid"})).appendChild(e.p({class:"title is-3 is-capitalized"},l)),c.appendChild(e.div({class:"columns is-mobile is-multiline albumart"},r.map(function(e){return i({title:e.title,subtitle:e.artist,subtitleHref:"artist/"+encodeURIComponent(e.artist),subtitleUri:"",image:e.albumart,href:"album/"+encodeURIComponent(e.artist)+"/"+encodeURIComponent(e.title)})}))),o.appendChild(c);break;case"artist":l=s.artist.title,r=s.albums,(c=e.div({class:"container is-fluid"})).appendChild(e.div({class:"columns artist-info is-mobile"},e.div({class:"column is-2-tablet is-2-desktop is-4-mobile"},e.figure({class:"image artistart"},e.img({src:s.artist.albumart}))),e.div({class:"column is-4"},e.p({class:"title is-4"},s.artist.title),e.p({class:"subtitle is-6"},r.length+" album"+(r.length>1||0===r.length?"s":""))))),c.appendChild(e.div({class:"columns is-mobile is-multiline albumart"},r.map(function(e){return i({title:e.title,image:e.albumart,href:"album/"+encodeURIComponent(s.artist.title)+"/"+encodeURIComponent(e.title),uri:e.uri})}))),o.appendChild(c);break;case"artists":var u=s;(c=e.div({class:"container is-fluid"})).appendChild(e.p({class:"title is-3 is-capitalized"},l)),c.appendChild(e.div({class:"columns is-mobile is-multiline artistart"},u.map(function(e){return i({title:e.title,image:e.albumart,href:"artist/"+encodeURIComponent(e.title)})}))),o.appendChild(c);break;case"genres":var p=s;(c=e.div({class:"container is-fluid"})).appendChild(e.p({class:"title is-3 is-capitalized"},l)),c.appendChild(e.div({class:"columns is-mobile is-multiline albumart"},p.map(function(e){return i({title:e.title,image:"/img/icons/playlist-padded.svg",href:"genre/"+encodeURIComponent(e.title)})}))),o.appendChild(c);break;case"genre":l=router.lastRoute().params.genre,(s=s.navigation.lists).forEach(function(t){var s=e.div({class:"columns is-mobile is-multiline"});if(t.title.indexOf("Tracks")>0){var l="artist";0===t.title.indexOf("Albums")?(l="album",s.classList.add("albumart")):s.classList.add("artistart"),t.items.forEach(e=>{var t=l;"album"===t&&(t=t+"/"+encodeURIComponent(e.artist.trim())),s.appendChild(i({title:e.title,image:webSocket.getURL(e.albumart),href:t+"/"+encodeURIComponent(e.title)}))})}else{var n=e.tbody();t.items.forEach((e,t)=>{n.appendChild(a(e))}),s.appendChild(e.table({class:"table is-fullwidth songs songs-hover"},n))}(c=e.div({class:"container is-fluid"})).appendChild(e.p({class:"title"},t.title)),c.appendChild(s),o.appendChild(c)});break;case"playlists":(c=e.div({class:"container is-fluid"})).appendChild(e.p({class:"title is-3 is-capitalized page-title"},l)),c.appendChild(e.div({class:"columns is-mobile is-multiline playlist-list"},s.map(function(e){return i({title:e,image:"/img/icons/playlist-padded.svg",href:"playlist/"+encodeURIComponent(e)})}))),o.appendChild(c);break;case"playlist":l=s.name,c=document.createDocumentFragment(),songs=[],s.lists&&s.lists.length>0?songs=s.lists[0]:"navigation"in s&&"lists"in s.navigation&&s.navigation.lists[0].items.length>0&&(songs=s.navigation.lists[0].items);var m="";m="navigation"in s?s.navigation.info.name:s.name,o.appendChild(e.div({class:"columns is-multiline is-mobile playlist-detail"},e.div({class:"column is-4-desktop is-12-mobile"},e.figure({class:"image is-1by1 albumart"},e.img({src:"/img/icons/playlist-padded.svg"}))),e.div({class:"column is-8-desktop is-12-mobile"},e.h5({class:"is-uppercase has-text-weight-semibold"},"Playlist"),e.h2({class:"title album-title has-text-weight-semibold is-capitalized"},m),e.table({class:"table is-fullwidth songs songs-hover"},e.tbody(songs.map(t=>e.tr({"data-uri":t.uri},e.td(e.figure({class:"image is-24x24"},e.img({src:webSocket.getURL(t.albumart)}))),e.td(t.title),e.td(e.a({href:"artist/"+encodeURIComponent(t.artist)},t.artist)),e.td(e.a({href:"album/"+encodeURIComponent(t.artist)+"/"+encodeURIComponent(t.album)},t.album)),e.td(e.span({class:"delete",on:{click:function(){webSocket.action.removeFromPlaylist({name:`${m}`,uri:`${t.uri}`})}}})))))))))}uiTools.setPageTitle({title:l}),router.update(),t=""}},updateState:function(e){var s=dataTools.changeState(e),i=dataTools.getState();if(s.includes("albumart")&&(document.querySelector("#control-bar .now-playing img").src=i.albumart),i.albumart||(document.querySelector("#control-bar .now-playing img").src="/img/notplaying.png"),s.includes("title")&&(document.querySelector("#control-bar .now-playing .title").innerText=i.title),s.includes("artist")&&(document.querySelector("#control-bar .now-playing .subtitle").innerText=i.artist),s.includes("repeat")&&(!0===i.repeat?document.querySelector("#control-bar .misc-controls .repeat").classList.add("is-active"):document.querySelector("#control-bar .misc-controls .repeat").classList.remove("is-active")),s.includes("random")&&(!0===i.random?document.querySelector("#control-bar .misc-controls .random").classList.add("is-active"):document.querySelector("#control-bar .misc-controls .random").classList.remove("is-active")),s.includes("elapsed")&&(uiTools.progress.set(i.elapsed,i.duration),document.querySelector("#control-bar .seek").innerText=uiTools.formatTime(i.elapsed),document.querySelector("#control-bar .duration").innerText=uiTools.formatTime(i.duration)),s.includes("state")){var a=document.querySelector(".playing-controls .play-button").querySelector("use");"play"===i.state?(a.setAttribute("xlink:href","/img/feather-sprite.svg#pause"),uiTools.progress.startCounting()):(a.setAttribute("xlink:href","/img/feather-sprite.svg#play"),uiTools.progress.stopCounting(),uiTools.progress.updateProgress()),uiTools.setPageTitle({state:i})}"home"===t?(l.build("home"),uiTools.setPageTitle()):(s.includes("status")||s.includes("title"))&&webSocket.get.queue()},settings:function(t){var i=uiTools.clearNodes("#content-container"),a=e.div({class:"tabs"},e.ul(["library","playback","appearance","system","plugins","alarm","sleep","help"].map(s=>e.li({class:t===s?"is-active":""},e.a({href:"settings/"+s,"data-navigo":"",class:"is-capitalized"},s)))));i.appendChild(a);var l=e.div({id:"setting-page"});switch(t){case"library":uiTools.setPageTitle("Library Setttings");var n=document.createDocumentFragment();n.appendChild(e.div({class:"box"},e.p({class:"title"},"Database"),e.div({class:"field is-horizontal"},e.div({class:"field-label"},e.label({class:"label"},"Songs")),e.div({class:"field-body"},e.div({class:"field song-count"},"Loading"))),e.div({class:"field is-horizontal"},e.div({class:"field-label"},e.label({class:"label"},"Artists")),e.div({class:"field-body"},e.div({class:"field artist-count"},"Loading"))),e.div({class:"field is-horizontal"},e.div({class:"field-label"},e.label({class:"label"},"Albums")),e.div({class:"field-body"},e.div({class:"field album-count"},"Loading"))),e.div({class:"field is-horizontal"},e.div({class:"field-label"}),e.div({class:"field-body"},e.div({class:"field"},e.div({class:"control"},e.div({class:"buttons"},e.button({class:"button is-primary",on:{click:()=>{webSocket.action.updateLibrary()}}},"Update Library"),e.button({class:"button is-primary",on:{click:()=>{webSocket.action.rescanLibrary()}}},"Rescan Library"),e.button({class:"button is-primary",on:{click:()=>{webSocket.action.updateMetadata()}}},"Update Metadata")))))))),n.appendChild(e.div({class:"box"},e.p({class:"title"},"Network shares"),e.div({class:"field is-horizontal"},e.div({class:"field-label"}),e.div({class:"field-body"},e.div({class:"field"},e.div({class:"control"},e.div({class:"buttons"},e.button({class:"button is-primary",on:{click:function(){o.addShare()}}},"Add share")))))))),l.appendChild(n),webSocket.get.libraryStats(e=>{l.querySelector(".field.song-count").innerText=e.songs,l.querySelector(".field.artist-count").innerText=e.artists,l.querySelector(".field.album-count").innerText=e.albums});break;case"playback":uiTools.setPageTitle("Playback Setttings"),(n=document.createDocumentFragment()).appendChild(e.div({class:"box"},e.p({class:"title"},"Audio"),e.div({class:"field is-horizontal"},e.div({class:"field-label"},e.label({class:"label"},"Playback device")),e.div({class:"field-body"},e.div({class:"field"},e.div({class:"select",id:"playback-device"})))))),l.appendChild(n),webSocket.get.audioDevices(t=>{var s=document.querySelector("#playback-device");if(void 0!==s&&t){var i=t.devices.active.id,a=t.devices.available.map(t=>e.option({"data-id":t.id,selected:t.id===i?"true":"false"},t.name));uiTools.clearNodes(s),s.appendChild(e.select(a))}});break;case"system":uiTools.setPageTitle("System Setttings"),(n=document.createDocumentFragment()).appendChild(e.div({class:"box"},e.p({class:"title"},"General"),e.div({class:"field is-horizontal"},e.div({class:"field-label"},e.label({class:"label"},"Device name")),e.div({class:"field-body"},e.div({class:"field  has-addons",id:"device-name"},e.div({class:"control"},e.input({class:"input",type:"text",on:{keyup:function(){this.parentNode.querySelector("button").classList.remove("is-hidden")}}})),e.div({class:"control"},e.button({class:"button is-primary",on:{click:function(){webSocket.set.deviceName(this.parentNode.querySelector("input").value)}}},uiTools.getSVG("save")))))),e.div({class:"field is-horizontal"},e.div({class:"field-label"},e.label({class:"label"},"Version")),e.div({class:"field-body"},e.div({class:"field",id:"system-version"},e.p(e.span(),e.button({class:"button is-small is-primary",on:{click:function(){webSocket.action.updateCheck(),this.classList.add("is-info"),this.classList.add("is-loading")}}},uiTools.getSVG("rotate-cw")))))),e.div({class:"field is-horizontal"},e.div({class:"field-label is-normal"},e.label({class:"label"},"Power")),e.div({class:"field-body"},e.div({class:"field"},e.div({class:"control"},e.div({class:"buttons"},e.button({class:"button is-danger",on:{click:()=>{webSocket.action.reboot(),s(!0,{msg:"Rebooting"})}}},"Reboot"),e.button({class:"button is-danger",on:{click:()=>{webSocket.action.shutdown(),s(!0,{msg:"Powering down"})}}},"Shutdown")))))))),l.appendChild(n),webSocket.get.version(e=>{var t=document.querySelector("#system-version p span");if(void 0!==t&&e){var s=e.systemversion+" ("+e.builddate+") ";t.innerText=s}}),webSocket.get.deviceName(e=>{var t=document.querySelector("#device-name input");void 0!==t&&e&&(t.value=e.name)})}i.appendChild(l),router.update()}},o={addShare:function(){var t=e.div({id:"update-detail-modal",class:"modal modal-fx-3dSignDown"},e.div({class:"modal-background"}),e.div({class:"modal-content"},e.div({class:"box is-paddingless"},e.div({class:"columns is-paddingless is-marginless"},e.div({class:"corner-image has-background-light is-paddingless is-hidden-mobile"},e.p({class:"title"},"Add Share"),e.img({src:"/img/modal-corner-add.svg"})),e.div({class:"column"},e.p("Music library"),e.p({class:"title"},"Add share"),e.div({class:"field"},e.div({class:"control"},e.input({class:"input name",type:"text",placeholder:"Share name"})),e.p({class:"help is-danger"})),e.div({class:"field"},e.div({class:"control"},e.input({class:"input address",type:"text",placeholder:"IP address"})),e.p({class:"help is-danger"})),e.div({class:"field"},e.div({class:"control"},e.input({class:"input path",type:"text",placeholder:"Path (e.g. /export/music)"})),e.p({class:"help is-danger"})),e.div({class:"field"},e.div({class:"control"},e.div({class:"select is-fullwidth"},e.select({class:"type"},e.option({value:"nfs"},"NFS"),e.option({value:"smb"},"SMB")))),e.p({class:"help is-danger"})),e.div({class:"field"},e.div({class:"control"},e.input({class:"input username",type:"text",placeholder:"Username"})),e.p({class:"help is-danger"})),e.div({class:"field"},e.div({class:"control"},e.input({class:"input password",type:"password",placeholder:"Password"})),e.p({class:"help is-danger"})),e.div({class:"field"},e.div({class:"control"},e.input({class:"input options",type:"text",placeholder:"Options"})),e.p({class:"help is-danger"})),e.div({class:"field first-button"},e.div({class:"control"},e.button({class:"button is-primary is-fullwidth",on:{click:function(){uiTools.handlers.addShare(this)}}},"Add"))),e.div({class:"field"},e.div({class:"control"},e.button({class:"button is-text is-fullwidth",on:{click:function(){this.closest(".modal").classList.remove("is-active")}}},"Close"))))))));uiTools.clearNodes("#modal-container").appendChild(t),window.setTimeout(()=>{t.classList.add("is-active")},250)},addToPlaylist:function(t){var s=t.target.closest("tr").dataset,i=e.div({class:"modal is-small modal-fx-3dSignDown"},e.div({class:"modal-background"}),e.div({class:"modal-content"},e.div({class:"box"},e.p({class:"title"},"Select a playlist"),e.table({class:"table is-fullwidth table-hover"}),e.button({class:"button is-light is-fullwidth",on:{click:uiTools.closeModal}},"Cancel"))));webSocket.get.playlists(t=>{var a=e.tbody(t.map(function(t){return e.tr(e.td(t),e.td(e.button({class:"button",on:{click:()=>{webSocket.action.addToPlaylist({name:`${t}`,service:`${s.service}`,uri:`${s.uri}`}),uiTools.closeModal()}}},"Select")))}));i.querySelector("table").appendChild(a)}),uiTools.clearNodes("#modal-container").appendChild(i),window.setTimeout(()=>{i.classList.add("is-active")},250)}};return{queueTable:function(t){var s=document.querySelector("#queue-table");if(null!==s){s=uiTools.clearNodes(s);for(var i=document.createDocumentFragment(),a=dataTools.getStatus(),l=dataTools.getQueuePosition(),o=0;o<=t.length-1;o++)i.appendChild(e.tr({class:o===l?"is-playing":""},e.td(e.figure({class:"image albumart "+a+" is-32x32"},e.img({src:t[o].albumart}))),e.td({class:"song-title","data-position":o,on:{click:function(){webSocket.action.play(this.dataset.position)}}},t[o].title),e.td(t[o].artist),e.td({class:"is-hidden-mobile"},t[o].album),e.td(uiTools.formatTime(t[o].duration)),e.td({class:"remove",on:{click:uiTools.handlers.removeSong}},e.span({class:"delete"}))));s.appendChild(i)}},page:l}}(),router=function(){var e=new window.Navigo("/",!1,"#");return{update:function(){e.updatePageLinks()},lastRoute:function(){return e.lastRouteResolved()},init:function(){e.updatePageLinks(),e.on({playlists:function(){domBuilder.page.setLoad("playlists"),webSocket.get.playlists()},"playlist/:playlist":function(e){domBuilder.page.setLoad("playlist"),webSocket.get.playlist(e.playlist)},files:function(){domBuilder.page.setLoad("files"),webSocket.get.files()},artists:function(){domBuilder.page.setLoad("artists"),webSocket.get.artists()},"artist/:artist":function(e){console.log(e),domBuilder.page.setLoad("artist"),webSocket.get.artistAlbums(e.artist)},albums:function(){domBuilder.page.setLoad("albums"),webSocket.get.albums()},"album/:artist/:album":function(e){domBuilder.page.setLoad("album"),webSocket.get.album(e.artist,e.album)},genres:function(){domBuilder.page.setLoad("genres"),webSocket.get.genres()},"genre/:genre":function(e){domBuilder.page.setLoad("genre"),webSocket.get.genres(encodeURIComponent(e.genre))},"settings/:page":function(e){domBuilder.page.setLoad("settings"),domBuilder.page.settings(e.page)},settings:function(){e.navigate("settings/library")},"*":function(){domBuilder.page.setLoad("home"),void 0!==dataTools.getState()&&0!==Object.keys(dataTools.getState()).length&&(domBuilder.page.build("home"),uiTools.setPageTitle("Audiophile Music Player"))}}).resolve()}}}(),uiTools=function(){var e="";return{clearNodes:function(e){for("string"==typeof e&&(e=document.querySelector(e));e.firstChild;)e.firstChild.remove();return e},getSVG:function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("feather");var s=document.createElementNS("http://www.w3.org/2000/svg","use");return s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","/img/feather-sprite.svg#"+e),t.appendChild(s),t},setPageTitle:function({title:t,state:s}={}){var i="";void 0!==t?(e=t,i=t):i=e,void 0!==s&&"play"===s.status&&(i=s.title+" - "+s.artist),i=void 0!==i?i.charAt(0).toUpperCase()+i.slice(1):"Audiophile Music Player",document.title=i+" | Moosic"},progress:{_seek:0,_duration:0,_counter:!1,stopCounting:function(){clearInterval(this._counter)},startCounting:function(){var e=dataTools.getState();this._seek=e.seek,this._duration=e.duration,this._counter=setInterval(()=>{this._seek+=100;var e=Math.round(Math.round(this._seek/100)/this._duration*100);isNaN(e)||e===1/0||(document.querySelector("#control-bar .play-progress progress").value=e)},100)},set:function(e,t){this._seek=e,this._duration=t},updateProgress:function(){console.log(this._seek),console.log(this._duration);var e=Math.round(this._seek/100/(100*this._duration));e=this._seek/this._duration*1e3;console.log(e),isNaN(e)||e===1/0||(document.querySelector("#control-bar .play-progress progress").value=e)}},formatTime:function(e){return((e=Math.round(e))-(e%=60))/60+(e>9?":":":0")+e},showBackground:function(e){},handlers:{tracks:function(e){for(var t=this.closest("tbody").querySelectorAll("tr"),s=[],i=0,a=this.closest("tr").dataset.uri,l=0;l<t.length;l++)s.push({uri:t[l].dataset.uri}),t[l].dataset.uri===a&&(i=l);webSocket.action.replaceAndPlay(s,i)},dropdown:function(e){this.closest(".dropdown").classList.toggle("is-active")},removeSong:function(e){var t=this.closest("tr").dataset.position;webSocket.action.removeFromQueue(t)},playSong:function(e){webSocket.action.addPlay({uri:this.closest("tr").dataset.uri}),this.closest(".dropdown").classList.remove("is-active")},queueSong:function(e){var t=[{uri:this.closest("tr").dataset.uri}];webSocket.action.enqueue(t),this.closest(".dropdown").classList.remove("is-active")},replaceWithSong:function(e){webSocket.action.replaceAndPlay([{uri:this.closest("tr").dataset.uri}]),this.closest(".dropdown").classList.remove("is-active")},addShare:function(e){var t=e.closest(".column"),s={name:t.querySelector(".name").value,ip:t.querySelector(".address").value,path:t.querySelector(".path").value,fstype:t.querySelector(".type").value,username:t.querySelector(".username").value,password:t.querySelector(".password").value,options:t.querySelector(".options").value};webSocket.action.addShare(s)}},closeModal:function(){var e=document.querySelector("#modal-container .modal");void 0!==e&&e.classList.remove("is-active")},init:function(){document.querySelector(".playing-controls .play-button").addEventListener("click",function(e){"play"===dataTools.getState().state?webSocket.action.pause():webSocket.action.play()}),document.querySelector(".misc-controls .repeat").addEventListener("click",function(e){webSocket.action.toggleRepeat()}),document.querySelector(".playing-controls .next").addEventListener("click",function(e){webSocket.action.next()}),document.querySelector(".playing-controls .prev").addEventListener("click",function(e){webSocket.action.prev()}),document.querySelector(".misc-controls .random").addEventListener("click",function(e){webSocket.action.toggleRandom()}),document.querySelector("html").addEventListener("click",function(e){var t=e.target||e.srcElement,s=t.closest(".dropdown");document.querySelectorAll(".dropdown").forEach(function(e){null!==s&&s.id===e.id||e.classList.remove("is-active")}),t.classList&&t.classList.contains("modal-backgqnd")&&t.closest(".modal").classList.remove("is-active")}),document.querySelectorAll(".modal .modal-closer").forEach(function(e){e.addEventListener("click",function(e){this.closest(".modal").classList.remove("is-active")})}),document.querySelector(".navbar-burger").addEventListener("click",function(e){this.classList.toggle("is-active");var t=this.closest(".navbar");t.classList.toggle("is-active"),t.querySelector(".navbar-menu").classList.toggle("is-active")}),document.querySelectorAll(".navbar-menu .navbar-item").forEach(e=>{e.addEventListener("click",t=>{var s=e.closest(".navbar"),i=s.querySelector(".navbar-burger");s.classList.toggle("is-active"),i.classList.toggle("is-active"),s.querySelector(".navbar-menu").classList.toggle("is-active")})})}}}(),webSocket=function(){var e,t=function(e){console.log(e)},s={state:function(){e.send("getStatus")},queue:function(){e.send("getQueue")},shares:function(){e.send("getOutputs")},playlists:function(){e.send("getPlaylists")},playlist:function(t){e.send("getPlaylist",{name:t})},artists:function(){e.send("getArtists")},artistAlbums:function(t){e.send("getArtistAlbums",{artist:t})},album:function(t,s){e.send("getAlbum",{artist:t,title:s})},albums:function(){e.send("getAlbums")},genres:function(){e.send("getGenres")},libraryStats:function(){e.send("getStats")},outputDevices:function(){e.send("getOutputs")}},i=function(){e.bind("pushArtists",domBuilder.page.build).bind("pushAlbums",domBuilder.page.build).bind("pushGenres",domBuilder.page.build).bind("pushArtistAlbums",domBuilder.page.build).bind("pushAlbum",domBuilder.page.build).bind("pushPlaylists",domBuilder.page.build).bind("pushPlaylist",domBuilder.page.build).bind("pushStatus",domBuilder.page.updateState).bind("pushQueue",domBuilder.queueTable),s.state()};return{init:function(s,a){(e=new function(e){e=e;var t=new WebSocket(e),s={};this.bind=function(e,t){return s[e]=s[e]||[],s[e].push(t),this},this.send=function(e,s){var i=JSON.stringify({event:e,data:s});return t.send(i),this};var i=function(){t.onmessage=function(e){var t=JSON.parse(e.data);a(t.event,t.data)},t.onclose=function(e){a("close",e)},t.onopen=function(){a("open",null)}};i(),this.bind("close",s=>{1e3!=s.code&&setTimeout(function(){console.log("WebSocketClient: reconnecting..."),t=new WebSocket(e),i()},3e3)});var a=function(e,t){var i=s[e];if(void 0!==i)for(var a=0;a<i.length;a++)i[a](t)}}("ws://"+s+":8080")).bind("open",()=>{a(),i()}),e.bind("notification",e=>t)},get:s,set:{},action:{clearQueue:function(){e.send("clearQueue")},addPlay:function(t,s){index=index||0,e.send("addPlay",{songs:t,pos:s})},replaceAndPlay:function(t,s){index=index||0,e.send("replaceAndPlay",{songs:t,pos:s})},enqueue:function(t){e.send("addToQueue",{songs:t})},removeFromQueue:function(t){e.send("removeFromQueue",{value:t})},saveQueue:function(t){void 0!==t&&e.send("saveQueueToPlaylist",{name:t})},play:function(t){void 0===t?e.send("play"):e.send("play",{pos:t})},pause:function(){console.log("pausing"),e.send("pause")},next:function(){e.send("next")},prev:function(){e.send("prev")},toggleRandom:function(){var t=dataTools.getState().random;e.send("random",{state:!t})},toggleRepeat:function(){dataTools.getState()},updateLibrary:function(){e.send("updateDB")},rescanLibrary:function(){e.send("rescanDB")},addShare:function({name:t,ip:s,path:i,fstypes:a}={}){e.send("addMount",{name:t,ip:s,path:i,fstype:fstype})},shudown:function(){e.send("shutdown")},reboot:function(){e.send("reboot")},addToPlaylist:function({name:e,service:t,uri:s}){},removeFromPlaylist:function({name:e,uri:t}){}},getURL:function(e){return"http://"+e},getSocket:function(){return _socket}}}();